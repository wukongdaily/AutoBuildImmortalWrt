#!/bin/bash
set -e

echo "=============================="
echo "  Han 专属 x86-64 构建脚本"
echo "=============================="

# 24.10 x86-64 的默认 PROFILE 通常是 generic
PROFILE="generic"
INCLUDE_DOCKER="${INCLUDE_DOCKER:-yes}"

# 打印一下当前的配置，方便在日志里确认
echo "当前构建配置："
echo "  PROFILE        = $PROFILE"
echo "  INCLUDE_DOCKER = $INCLUDE_DOCKER"

# 整合软件包
EXTRA_PACKAGES=""
if [ "$INCLUDE_DOCKER" = "yes" ]; then
    EXTRA_PACKAGES="$EXTRA_PACKAGES docker dockerd docker-compose luci-app-dockerman"
fi

# 核心构建命令
# 注意：files 目录现在在 /home/build/custom_files/files
make image PROFILE="$PROFILE" \
    FILES="/home/build/custom_files/files" \
    PACKAGES="$EXTRA_PACKAGES"

echo "构建完成！"
